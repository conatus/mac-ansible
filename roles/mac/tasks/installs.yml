- name: Add Homebrew taps
  homebrew_tap:
    name: "{{ item }}"
    state: present
  loop: "{{ homebrew_taps }}"
  tags:
  - brew
  - installs

- name: Update Homebrew
  homebrew:
    update_homebrew: yes
  tags:
  - brew
  - installs

- name: Uninstall Homebrew packages
  homebrew:
    name: "{{ item }}"
    state: absent
  loop: "{{ homebrew_package_removals }}"
  tags:
  - brew
  - installs

- name: Install Homebrew packages
  homebrew:
    name: "{{ item }}"
    state: latest
  loop: "{{ homebrew_packages }}"
  tags:
  - brew
  - installs

- name: Install Yarn
  homebrew:
    name: yarn
    state: latest
    install_options: without
  tags:
    - nodejs
    - installs

- name: Uninstall Homebrew Casks
  homebrew_cask:
    name: "{{ item }}"
    state: absent
  loop: "{{ homebrew_cask_removals }}"
  tags:
  - brew
  - cask
  - installs

- name: Install Homebrew Cask packages
  homebrew_cask:
    name: "{{ item }}"
    state: present
    install_options: "appdir=/Applications"
  loop: "{{ homebrew_cask_packages }}"
  tags:
  - brew
  - cask
  - installs

- name: Install nvm
  shell: curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash
  args:
    chdir: "{{ ansible_env.HOME }}"
    creates: "{{ ansible_env.HOME }}/.nvm/nvm.sh"
    executable: /bin/bash
    warn: False
  tags:
  - nodejs
  - installs

- name: Install Node.js versions
  shell: >
    . {{ ansible_env.HOME }}/.nvm/nvm.sh && nvm install {{ item }}
  args:
    executable: /bin/bash
    chdir: "{{ ansible_env.HOME }}"
    creates: "{{ ansible_env.HOME }}/.nvm/versions/{{ item }}"
  loop:
  - node
  tags:
  - nodejs
  - installs